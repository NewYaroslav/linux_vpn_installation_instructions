# linux_vpn_installation_instructions
Инструкция "как поднять свой VPN"

## Как настроить свой VPN (Простой вариант)

Данная инструкция основана на использовании OpenVPN, [оригинальная статья](https://lifehacker.ru/kak-podnyat-vpn/) и скрипте [openvpn-install](https://github.com/Nyr/openvpn-install). В инструкции есть комментарии по исправлению ошибок во время настройки OpenVPN.

Более сложный вариат описан [тут](http://www.spy-soft.net/configuring-openvpn-stunnel/) и [тут](https://www.digitalocean.com/community/tutorials/how-to-set-up-and-configure-an-openvpn-server-on-centos-7).

### Шаг 1. Выбираем хостинг

* Сервер находится в стране, которая не подпадает под юрисдикцию российских органов власти, но находится достаточно близко к вашему реальному местоположению.
* Оперативной памяти (RAM) должно быть не меньше 512 МБ.
* Скорость сетевого интерфейса — 100 МБ/сек и выше.
* Сетевой трафик — 512 ГБ и выше или неограниченный.

Количество выделенного места на жёстком диске и тип накопителя не имеет значения. Найти подходящее решение можно за 3–4 доллара в месяц. При покупке сервера выбирайте KVM. OpenVZ и Xen тоже подойдут, если у них подключён TUN — об этом нужно спросить в технической службе хостинг-провайдера. С KVM никаких дополнительных манипуляций производить не придётся, хотя некоторые хостинг-провайдеры и на нём могут ограничить возможность создания VPN. Уточнить это можно также в службе поддержки.

Один из дешевых вариантов [ruvps](https://ruvps.net/?from=1778), достаточно будет взять самый дешевый сервер за 230 рублей в месяц.

### Шаг 2. Настраиваем VPN

* Для подключения к серверу и отправки команд мы будем использовать программу [Putty](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html). Putty и её аналоги есть и на macOS, настройки будут идентичными.

* Запустите Putty. На вкладке Session в поле Host Name введите IP-адрес своего сервера, который пришёл в письме, и нажмите Open.

* При появлении окна с предупреждением об опасности нажмите «Да». После этого запустится консоль, через которую вы будете отправлять команды серверу. 

* Для начала нужно залогиниться — данные для авторизации также есть в письме от хостера. Логин будет root, его напечатайте руками. Пароль скопируйте в буфер обмена. Для вставки пароля в консоль щёлкните правой кнопкой и нажмите Enter. Пароль не отобразится в консоли, но если вы авторизовались, то увидите информацию о системе или номер сервера.

* Между вводом логина и пароля не должно пройти много времени. Если появилось сообщение об ошибке, перезапустите Putty и попробуйте ещё раз.

* Для настройки VPN можно использовать готовый скрипт OpenVPN road warrior. Этот способ не гарантирует полную анонимность, так что при совершении противозаконных действий пользователя легко найти. Но для обхода блокировки его достаточно. Если все VPN-сервисы перестанут работать, это подключение продолжит функционировать, пока я плачу за хостинг. 

Перед тем, как использовать скрипт, убедитесь, что на сервере установлен **tar**. Если tar не установлен (с такой ошибкой можно столкнуться на CentOS 8), установите его, используя следующие команды:

**Для CentOS** ([источник](https://stackoverflow.com/questions/27613153/tar-command-not-found-in-dockerfile))

```
yum -y update && \
    yum -y install wget && \
    yum install -y tar.x86_64 && \
    yum clean all
```

Далее можно приступить к установке OpenVPN. Чтобы использовать скрипт, вставьте в консоль строчку:

```
wget https://git.io/vpn -O openvpn-install.sh && bash openvpn-install.sh
```

Если OpenVPN уже был ранее установлен, и из-за этого возникли ошибки, вы можете запустить скрипт повторно и выбрать опцию удаления OpenVPN.

* После успешного добавления скрипта запустится диалог с мастером настройки. Он самостоятельно находит оптимальные значения, вам останется только согласиться или выбрать подходящий вариант. Все действия подтверждаются нажатием клавиши Enter. Пойдём по порядку:

1. IP-адрес должен совпадать с IP-адресом, который вы получили в письме от хостера.
2. Протокол оставьте по умолчанию UDP.
3. Port:1194 - оставьте без изменений
4. Какой DNS использовать — выберите Google. Напишите 3 и нажмите Enter.
5. Client name — укажите имя пользователя. Можно оставить client.
6. Press any key — ещё раз нажмите Enter и дождитесь окончания настройки.

* После завершения настройки необходимо создать файл, через который вы будете подключаться к VPN. Введите команду:

```
cat ~/client.ovpn
```

В консоли появится содержимое файла. Прокрутите экран наверх к команде *cat ~/client.ovpn* и выделите всё, что появилось ниже, кроме последней строчки. Выделение должно закончиться на *</tls-auth>*. Для копирования фрагмента нажмите *Ctrl + V*.

* Создайте текстовый файл, откройте через блокнот, вставьте скопированный фрагмент и сохраните файл на рабочем столе с именем *client.ovpn*

### Шаг 3. Подключаемся к серверу

* Для подключения с помощью созданного файла нужен клиент OpenVPN. Версию для компьютера можно скачать [здесь](https://openvpn.net/community-downloads/). Загрузите и установите программу, но не запускайте. Щёлкните правой кнопкой по файлу *client.ovpn* и выберите пункт *Start OpenVPN*.

* Появится окно консоли с инициализацией соединения. Если подключение прошло успешно, внизу будет статус *Initialization Sequence Completed*. В процессе соединения может появиться окно выбора сети, нажмите на общественную сеть.

* Если подключение завершается с ошибкой(что характерно для Windows 8):

```
Sun May 28 18:07:25 2017 Error in add_block_dns_filters(): add_sublayer:
failed to add persistent sublayer : Отказано в доступе. [status=0x5]
Sun May 28 18:07:25 2017 Blocking DNS failed!
Sun May 28 18:07:25 2017 Exiting due to fatal error
```

То необходимо из файла *client.ovpn* удалить строку *block-outside-dns*, которая идет сразу после *ignore-unknown-option block-outside-dns*

https://github.com/kylemanna/docker-openvpn/issues/330

* Чтобы убедиться, что подключение установлено верно, проверьте IP-адрес, например через этот [сервис](https://apihost.ru/ip). Он должен совпадать с тем, который хостер написал в письме. Чтобы перестать направлять запросы на сервер в другой стране, закройте окно OpenVPN





